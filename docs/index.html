<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MONITORING AKSES POINT RKS NET</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: #f5f5f5; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { background: #0066cc; color: white; padding: 20px; text-align: center; }
        .header h1 { font-size: 24px; margin-bottom: 5px; }
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 20px; }
        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; }
        .stat-number { font-size: 32px; font-weight: bold; margin: 10px 0; }
        .total .stat-number { color: #0066cc; }
        .online .stat-number { color: #28a745; }
        .offline .stat-number { color: #dc3545; }
        .table-container { padding: 20px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 1200px; }
        th { background: #e9ecef; padding: 12px 15px; text-align: left; font-weight: 600; }
        td { padding: 12px 15px; border-bottom: 1px solid #eee; }
        tr:hover { background: #f8f9fa; }
        .status { padding: 4px 10px; border-radius: 4px; font-weight: bold; font-size: 12px; }
        .status.up { background: #d4edda; color: #155724; }
        .status.down { background: #f8d7da; color: #721c24; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.7; } }
        .footer { background: #f8f9fa; padding: 15px 20px; text-align: center; border-top: 1px solid #dee2e6; color: #666; font-size: 14px; }
        .update-time { font-weight: bold; color: #0066cc; }
        .loading { text-align: center; padding: 40px; }
        @media (max-width: 768px) { .stats { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>MONITORING AKSES POINT RKS NET</h1>
            <p>Monitoring 74 Pelanggan - Real Time Status</p>
        </div>
        
        <div class="stats">
            <div class="stat-card total">
                <div>Total Pelanggan</div>
                <div class="stat-number" id="total">0</div>
            </div>
            <div class="stat-card online">
                <div>Pelanggan Online</div>
                <div class="stat-number" id="online">0</div>
            </div>
            <div class="stat-card offline">
                <div>Pelanggan Offline</div>
                <div class="stat-number" id="offline">0</div>
            </div>
        </div>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th width="8%">NO</th>
                        <th width="35%">NAMA PEMILIK ROUTER</th>
                        <th width="25%">IP ADDRESS AKSES POINT</th>
                        <th width="12%">STATUS</th>
                        <th width="20%">LAST UPDATE</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr><td colspan="5" class="loading">Memuat data...</td></tr>
                </tbody>
            </table>
        </div>
        
        <div class="footer">
            <div>Terakhir update: <span class="update-time" id="lastUpdate">-</span></div>
            <div>Auto refresh dalam <span id="countdown">60</span> detik</div>
        </div>
    </div>

    <script>
        async function loadData() {
            try {
                const response = await fetch('./data/status.json?t=' + new Date().getTime());
                const data = await response.json();
                updateDashboard(data);
            } catch (error) {
                document.getElementById('tableBody').innerHTML = `
                    <tr><td colspan="5" style="text-align:center;color:#dc3545;padding:20px;">
                        ❌ Gagal memuat data. Pastikan GitHub Actions sudah berjalan.
                    </td></tr>`;
            }
        }
        
        function updateDashboard(data) {
            // Update stats
            document.getElementById('total').textContent = data.summary.total_customers;
            document.getElementById('online').textContent = data.summary.online_customers;
            document.getElementById('offline').textContent = data.summary.offline_customers;
            
            // Update last update
            const date = new Date(data.last_updated);
            document.getElementById('lastUpdate').textContent = 
                date.toLocaleString('id-ID', { hour12: false });
            
            // Update table
            let html = '';
            data.customers.forEach(customer => {
                html += `
                    <tr>
                        <td>${customer.no}</td>
                        <td><strong>${customer.name}</strong></td>
                        <td>${customer.ip}</td>
                        <td><span class="status ${customer.status.toLowerCase()}">${customer.status}</span></td>
                        <td>${date.toLocaleTimeString('id-ID', { hour12: false })}</td>
                    </tr>
                `;
            });
            document.getElementById('tableBody').innerHTML = html;
            
            // Alert jika ada offline
            if (data.summary.offline_customers > 0) {
                if (Notification.permission === 'granted') {
                    new Notification('⚠️ RKS NET Alert', {
                        body: `${data.summary.offline_customers} pelanggan OFFLINE`,
                        icon: 'https://cdn-icons-png.flaticon.com/512/2991/2991148.png'
                    });
                }
            }
        }
        
        // Auto refresh
        let countdown = 60;
        setInterval(() => {
            countdown--;
            document.getElementById('countdown').textContent = countdown;
            if (countdown <= 0) {
                countdown = 60;
                loadData();
            }
        }, 1000);
        
        setInterval(loadData, 60000);
        window.onload = loadData;
    </script>
</body>
</html>
